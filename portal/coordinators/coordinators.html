<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Extension Coordinators - Cavite State University Imus Campus</title>
  <link rel="stylesheet" href="coordinators.css">
</head>
<body>

  <!-- Sidebar Menu -->
  <nav class="app-sidebar" id="app-sidebar">
    <div class="app-sidebar-header">
      <button class="sidebar-close-btn" id="sidebar-close-btn">&#9776;</button>
      <div class="user-profile">
        <img src="../images/placeholder.jpg" alt="User Avatar" class="user-avatar">
        <div class="user-info">
          <h3 id="user-name">Guest</h3>
          <p class="status" id="user-role">Not signed in</p>
        </div>
      </div>
    </div>
    
    <ul class="nav-menu">
      <li class="nav-item">
        <a href="../home/home.html" class="nav-link">
          <span class="nav-icon">üè†</span>
          <span class="nav-text">Home</span>
        </a>
      </li>
      <li class="nav-item auth-required" style="display: none;">
        <a href="../archive/archive.html" class="nav-link">
          <span class="nav-icon">üì¶</span>
          <span class="nav-text">Archive</span>
        </a>
      </li>
      <li class="nav-item auth-required" style="display: none;">
        <a href="../../register/entry.php" class="nav-link">
          <span class="nav-icon">üöÄ</span>
          <span class="nav-text">Tracker</span>
        </a>
      </li>
      <li class="nav-divider auth-required" style="display: none;" aria-hidden="true"></li>
      <li class="nav-item auth-required" style="display: none;">
        <a href="#" class="nav-link">
          <span class="nav-icon">‚öôÔ∏è</span>
          <span class="nav-text">Account Settings</span>
        </a>
      </li>
      <li class="nav-item">
        <a id="auth-link" href="../../register/index.html" class="nav-link">
          <span class="nav-icon">üîì</span>
          <span class="nav-text" id="auth-link-text">Login</span>
        </a>
      </li>
    </ul>
  </nav>

  <!-- Overlay to close menu when clicking outside -->
  <div class="app-sidebar-overlay" id="app-sidebar-overlay"></div>

  <!-- Menu Icon Bar -->
  <div class="menu-bar">
    <div class="menu-icon">&#9776;</div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="logo-section" style="cursor: pointer;" onclick="window.location.href='../home/home.html'">
      <img src="../images/LOGOS/logo1.png" alt="CvSU Logo" class="logo">
      <div class="title">
        <h1>Cavite State University</h1>
        <h2>Imus Campus</h2>
        <p>Extension Services</p>
        
        <!-- Navigation Dropdown Menu -->
        <nav class="header-nav">
          <ul class="nav-dropdown-menu">
            <li class="nav-dropdown">
              <a href="#" class="nav-dropdown-toggle">About ‚ñæ</a>
              <ul class="nav-dropdown-content">
                <li><a href="../about/uae.html">University Extension Agenda</a></li>
                <li><a href="../about/fmd.html">Functions of the Major Divisions</a></li>
              </ul>
            </li>
            <li class="nav-dropdown">
              <a href="#" class="nav-dropdown-toggle">Departments ‚ñæ</a>
              <ul class="nav-dropdown-content">
                <li><a href="../departments/department_page.html?dept=1">Department of Biological and Physical Sciences</a></li>
                <li><a href="../departments/department_page.html?dept=2">Department of Computer Studies</a></li>
                <li><a href="../departments/department_page.html?dept=3">Department of Hospitality Management</a></li>
                <li><a href="../departments/department_page.html?dept=4">Department of Languages and Mass Communication</a></li>
                <li><a href="../departments/department_page.html?dept=5">Department of Management</a></li>
                <li><a href="../departments/department_page.html?dept=6">Department of Physical Education</a></li>
                <li><a href="../departments/department_page.html?dept=7">Department of Social Sciences and Humanities</a></li>
                <li><a href="../departments/department_page.html?dept=8">Teacher Education Department</a></li>
              </ul>
            </li>
            <li class="nav-dropdown admin-only" style="display: none;">
              <a href="#" class="nav-dropdown-toggle">Services ‚ñæ</a>
              <ul class="nav-dropdown-content">
                <li><a href="../../register/entry.php">eTracker</a></li>
              </ul>
            </li>
            <li class="nav-dropdown">
              <a href="#" class="nav-dropdown-toggle">Coordinators ‚ñæ</a>
              <ul class="nav-dropdown-content">
                <li><a href="coordinators.html">Extension Coordinators</a></li>
              </ul>
            </li>
          </ul>
        </nav>
      </div>
      <img src="../images/LOGOS/logo2.png" alt="Extension Logo" class="logo2">
    </div>
  </header>

  <!-- Main Content -->
  <main class="coordinators-container">
    <div class="page-header">
      <h1>Extension Services Coordinators</h1>
      <p>Meet our dedicated team of extension coordinators across all departments</p>
    </div>

    <!-- Admin Controls -->
    <div class="admin-controls" id="admin-controls" style="display: none;">
      <button class="edit-mode-btn" id="edit-mode-btn">
        <span class="btn-icon">‚úèÔ∏è</span> Edit Coordinators
      </button>
      <button class="add-coordinator-btn" id="add-coordinator-btn">
        Add Coordinator
      </button>
    </div>

    <!-- Edit Actions -->
    <div class="edit-actions" id="edit-actions">
      <button class="save-btn" id="save-btn">Save Changes</button>
      <button class="cancel-btn" id="cancel-btn">‚úñ Cancel</button>
    </div>

    <!-- Coordinators Grid -->
    <div class="coordinators-grid" id="coordinators-grid">
      <!-- Coordinators will be loaded dynamically -->
    </div>
  </main>

  <!-- Add Coordinator Modal -->
  <div class="modal-overlay" id="add-coordinator-modal">
    <div class="modal">
      <div class="modal-header">
        <h2>Add New Coordinator</h2>
        <button class="modal-close" id="modal-close">√ó</button>
      </div>
      <div class="modal-body">
        <form id="add-coordinator-form">
          <div class="form-group required">
            <label for="coordinator-name">Name</label>
            <input type="text" id="coordinator-name" required>
          </div>
          <div class="form-group required">
            <label for="coordinator-department">Department</label>
            <select id="coordinator-department" required>
              <option value="">Select Department</option>
              <option value="Department of Biological and Physical Sciences">Department of Biological and Physical Sciences</option>
              <option value="Department of Computer Studies">Department of Computer Studies</option>
              <option value="Department of Hospitality Management">Department of Hospitality Management</option>
              <option value="Department of Languages and Mass Communication">Department of Languages and Mass Communication</option>
              <option value="Department of Management">Department of Management</option>
              <option value="Department of Physical Education">Department of Physical Education</option>
              <option value="Department of Social Sciences and Humanities">Department of Social Sciences and Humanities</option>
              <option value="Teacher Education Department">Teacher Education Department</option>
              <option value="Others">Others</option>
            </select>
          </div>
          <div class="form-group required" id="other-department-group" style="display: none;">
            <label for="other-department-input">Specify Department</label>
            <input type="text" id="other-department-input" placeholder="Enter department name">
          </div>
          <div class="form-group">
            <label>Coordinator Image</label>
            <div class="image-upload-area" id="image-upload-area">
              <input type="file" id="coordinator-image" accept="image/*" style="display: none;">
              <div class="upload-placeholder" id="upload-placeholder">
                <p>Click to select or drag and drop an image</p>
                <small>JPEG, PNG, GIF, WebP (Max 5MB)</small>
              </div>
              <div class="image-preview" id="image-preview" style="display: none;">
                <img id="preview-img" src="" alt="Preview">
                <button type="button" class="remove-image-btn" id="remove-image-btn">√ó</button>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" id="modal-cancel">Cancel</button>
        <button class="btn-primary" id="modal-submit">Add Coordinator</button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-left">
      <img src="../images/placeholder.jpg" alt="CvSU Footer Logo">
      <p>Cavite State University<br>Extension Services</p>
    </div>
    <div class="footer-right">
      <p><strong>Contact Information</strong><br>
        Cavite Civic Center, Palico IV, Imus City, Cavite 4103<br>
        (046) 471-6607<br>
        cvis@cvsu.edu.ph
      </p>
    </div>
  </footer>

  <script>
    // Notification System
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification notification-${type}`;
      notification.textContent = message;
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : type === 'warning' ? '#ffc107' : '#17a2b8'};
        color: white;
        padding: 16px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 10001;
        font-weight: 500;
        animation: slideIn 0.3s ease-out;
        max-width: 400px;
      `;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-in';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // Load session
    async function loadSession() {
      try {
        const res = await fetch('../home/backend/session_user.php', { credentials: 'include' });
        if (!res.ok) throw new Error('Not authenticated');
        const data = await res.json();
        if (data && data.authenticated && data.user) {
          const name = `${data.user.firstname || ''} ${data.user.lastname || ''}`.trim() || data.user.email;
          document.getElementById('user-name').textContent = name;
          document.getElementById('user-role').textContent = data.user.role || 'Online';
          window.userRole = data.user.role;
          
          const authLink = document.getElementById('auth-link');
          const authText = document.getElementById('auth-link-text');
          authLink.href = '#';
          authText.textContent = 'Logout';
          
          authLink.onclick = function(e) {
            e.preventDefault();
            fetch('../../register/logout.php')
              .then(() => window.location.reload())
              .catch(err => {
                console.error('Logout error:', err);
                window.location.reload();
              });
          };
          
          document.querySelectorAll('.auth-required').forEach(el => {
            el.style.display = '';
          });
          
          if (data.user.role === 'admin') {
            document.querySelectorAll('.admin-only').forEach(el => {
              el.style.display = '';
            });
            // Show admin controls for coordinators page
            const adminControls = document.getElementById('admin-controls');
            if (adminControls) {
              adminControls.style.display = '';
            }
          }
        }
      } catch (e) {
        // Guest user
      }
    }

    // Sidebar functionality
    document.addEventListener('DOMContentLoaded', function() {
      const menuIcon = document.querySelector('.menu-icon');
      const sidebar = document.getElementById('app-sidebar');
      const overlay = document.getElementById('app-sidebar-overlay');
      const sidebarCloseBtn = document.getElementById('sidebar-close-btn');
      
      function toggleSidebar() {
        sidebar.classList.toggle('open');
        overlay.classList.toggle('active');
        menuIcon.classList.toggle('active');
      }
      
      menuIcon.addEventListener('click', toggleSidebar);
      
      if (sidebarCloseBtn) {
        sidebarCloseBtn.addEventListener('click', toggleSidebar);
      }
      
      overlay.addEventListener('click', toggleSidebar);
      
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && sidebar.classList.contains('open')) {
          toggleSidebar();
        }
      });

      // Admin edit functionality
      let isEditMode = false;
      let originalData = [];
      let draggedElement = null;

      const editModeBtn = document.getElementById('edit-mode-btn');
      const editActions = document.getElementById('edit-actions');
      const saveBtn = document.getElementById('save-btn');
      const cancelBtn = document.getElementById('cancel-btn');
      const addCoordinatorBtn = document.getElementById('add-coordinator-btn');

      // Modal elements
      const addModal = document.getElementById('add-coordinator-modal');
      const modalClose = document.getElementById('modal-close');
      const modalCancel = document.getElementById('modal-cancel');
      const modalSubmit = document.getElementById('modal-submit');
      const addForm = document.getElementById('add-coordinator-form');

      editModeBtn.addEventListener('click', function() {
        isEditMode = !isEditMode;
        toggleEditMode();
      });

      function toggleEditMode() {
        const cards = document.querySelectorAll('.coordinator-card');
        const names = document.querySelectorAll('.coordinator-name');
        const departments = document.querySelectorAll('.coordinator-department');

        if (isEditMode) {
          // Save original data
          originalData = [];
          cards.forEach((card) => {
            const id = card.dataset.id;
            const name = card.querySelector('.coordinator-name').textContent;
            const dept = card.querySelector('.coordinator-department').textContent;
            originalData.push({ id, name, dept });
          });

          // Enable editing
          names.forEach(name => name.setAttribute('contenteditable', 'true'));
          departments.forEach(dept => dept.setAttribute('contenteditable', 'true'));
          
          // Update button appearance
          editModeBtn.classList.add('active');
          editModeBtn.innerHTML = '<span class="btn-icon">‚úñ</span> Cancel Edit';
          editActions.classList.add('active');
          
          // Add editable class and drag handlers
          cards.forEach(card => {
            card.classList.add('editable', 'draggable');
            card.setAttribute('draggable', 'true');
            setupDragHandlers(card);
          });
        } else {
          // Disable editing
          names.forEach(name => name.removeAttribute('contenteditable'));
          departments.forEach(dept => dept.removeAttribute('contenteditable'));
          
          // Update button appearance
          editModeBtn.classList.remove('active');
          editModeBtn.innerHTML = '<span class="btn-icon">‚úèÔ∏è</span> Edit Coordinators';
          editActions.classList.remove('active');
          
          // Remove editable class and drag handlers
          cards.forEach(card => {
            card.classList.remove('editable', 'draggable');
            card.removeAttribute('draggable');
            removeDragHandlers(card);
          });
        }
      }

      // Drag and drop functions
      function setupDragHandlers(card) {
        card.addEventListener('dragstart', handleDragStart);
        card.addEventListener('dragend', handleDragEnd);
        card.addEventListener('dragover', handleDragOver);
        card.addEventListener('drop', handleDrop);
        card.addEventListener('dragleave', handleDragLeave);
      }

      function removeDragHandlers(card) {
        card.removeEventListener('dragstart', handleDragStart);
        card.removeEventListener('dragend', handleDragEnd);
        card.removeEventListener('dragover', handleDragOver);
        card.removeEventListener('drop', handleDrop);
        card.removeEventListener('dragleave', handleDragLeave);
      }

      function handleDragStart(e) {
        draggedElement = this;
        this.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/html', this.innerHTML);
      }

      function handleDragEnd(e) {
        this.classList.remove('dragging');
        document.querySelectorAll('.coordinator-card').forEach(card => {
          card.classList.remove('drag-over');
        });
      }

      function handleDragOver(e) {
        if (e.preventDefault) {
          e.preventDefault();
        }
        e.dataTransfer.dropEffect = 'move';
        return false;
      }

      function handleDrop(e) {
        if (e.stopPropagation) {
          e.stopPropagation();
        }
        
        if (draggedElement !== this) {
          const grid = document.getElementById('coordinators-grid');
          const allCards = Array.from(grid.children);
          const draggedIndex = allCards.indexOf(draggedElement);
          const targetIndex = allCards.indexOf(this);
          
          if (draggedIndex < targetIndex) {
            this.parentNode.insertBefore(draggedElement, this.nextSibling);
          } else {
            this.parentNode.insertBefore(draggedElement, this);
          }
        }
        
        this.classList.remove('drag-over');
        return false;
      }

      function handleDragLeave(e) {
        this.classList.remove('drag-over');
      }

      saveBtn.addEventListener('click', async function() {
        const coordinators = [];
        const cards = document.querySelectorAll('.coordinator-card');
        
        cards.forEach(card => {
          const id = card.dataset.id;
          const name = card.querySelector('.coordinator-name').textContent.trim();
          const dept = card.querySelector('.coordinator-department').textContent.trim();
          coordinators.push({ id, name, dept });
        });

        try {
          const response = await fetch('backend/update_coordinators.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify({ coordinators })
          });

          const result = await response.json();
          
          if (result.success) {
            showNotification('Changes saved successfully!', 'success');
            isEditMode = false;
            toggleEditMode();
            loadCoordinators(); // Reload to get fresh data
          } else {
            showNotification('Error saving changes: ' + (result.message || 'Unknown error'), 'error');
          }
        } catch (error) {
          console.error('Save error:', error);
          showNotification('Error saving changes. Please try again.', 'error');
        }
      });

      cancelBtn.addEventListener('click', function() {
        isEditMode = false;
        toggleEditMode();
        loadCoordinators(); // Reload original data
      });

      // Department dropdown handler - show/hide "Others" input
      const departmentSelect = document.getElementById('coordinator-department');
      const otherDepartmentGroup = document.getElementById('other-department-group');
      const otherDepartmentInput = document.getElementById('other-department-input');
      
      departmentSelect.addEventListener('change', function() {
        if (this.value === 'Others') {
          otherDepartmentGroup.style.display = 'block';
          otherDepartmentInput.required = true;
        } else {
          otherDepartmentGroup.style.display = 'none';
          otherDepartmentInput.required = false;
          otherDepartmentInput.value = '';
        }
      });

      // Image upload functionality
      const imageUploadArea = document.getElementById('image-upload-area');
      const coordinatorImageInput = document.getElementById('coordinator-image');
      const uploadPlaceholder = document.getElementById('upload-placeholder');
      const imagePreview = document.getElementById('image-preview');
      const previewImg = document.getElementById('preview-img');
      const removeImageBtn = document.getElementById('remove-image-btn');
      let selectedImageFile = null;

      // Click to upload
      imageUploadArea.addEventListener('click', function(e) {
        if (e.target !== removeImageBtn) {
          coordinatorImageInput.click();
        }
      });

      // File input change
      coordinatorImageInput.addEventListener('change', function(e) {
        if (e.target.files && e.target.files[0]) {
          handleImageFile(e.target.files[0]);
        }
      });

      // Drag and drop
      imageUploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        e.stopPropagation();
        this.classList.add('dragover');
      });

      imageUploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        e.stopPropagation();
        this.classList.remove('dragover');
      });

      imageUploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        e.stopPropagation();
        this.classList.remove('dragover');
        
        if (e.dataTransfer.files && e.dataTransfer.files[0]) {
          const file = e.dataTransfer.files[0];
          if (file.type.startsWith('image/')) {
            handleImageFile(file);
          } else {
            showNotification('Please drop an image file', 'warning');
          }
        }
      });

      // Handle image file
      function handleImageFile(file) {
        // Validate file size (5MB)
        if (file.size > 5 * 1024 * 1024) {
          showNotification('Image size must be less than 5MB', 'warning');
          return;
        }

        // Validate file type
        const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
        if (!validTypes.includes(file.type)) {
          showNotification('Please select a valid image file (JPEG, PNG, GIF, WebP)', 'warning');
          return;
        }

        selectedImageFile = file;

        // Show preview
        const reader = new FileReader();
        reader.onload = function(e) {
          previewImg.src = e.target.result;
          uploadPlaceholder.style.display = 'none';
          imagePreview.style.display = 'flex';
        };
        reader.readAsDataURL(file);
      }

      // Remove image
      removeImageBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        selectedImageFile = null;
        coordinatorImageInput.value = '';
        uploadPlaceholder.style.display = 'flex';
        imagePreview.style.display = 'none';
        previewImg.src = '';
      });

      // Add coordinator button
      addCoordinatorBtn.addEventListener('click', function() {
        addModal.classList.add('active');
        addForm.reset();
        selectedImageFile = null;
        uploadPlaceholder.style.display = 'flex';
        imagePreview.style.display = 'none';
        otherDepartmentGroup.style.display = 'none';
        otherDepartmentInput.required = false;
      });

      // Modal close buttons
      modalClose.addEventListener('click', () => addModal.classList.remove('active'));
      modalCancel.addEventListener('click', () => addModal.classList.remove('active'));
      
      // Close modal on overlay click
      addModal.addEventListener('click', function(e) {
        if (e.target === this) {
          this.classList.remove('active');
        }
      });

      // Submit new coordinator
      modalSubmit.addEventListener('click', async function() {
        const name = document.getElementById('coordinator-name').value.trim();
        let department = document.getElementById('coordinator-department').value;

        // Check if "Others" is selected
        if (department === 'Others') {
          const otherDept = document.getElementById('other-department-input').value.trim();
          if (!otherDept) {
            showNotification('Please specify the department name', 'warning');
            return;
          }
          department = otherDept;
        }

        if (!name || !department) {
          showNotification('Please fill in all required fields', 'warning');
          return;
        }

        try {
          const response = await fetch('backend/add_coordinator.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify({ name, department })
          });

          const result = await response.json();
          
          if (result.success) {
            // If there's an image, upload it
            if (selectedImageFile && result.id) {
              const formData = new FormData();
              formData.append('image', selectedImageFile);
              formData.append('coordinator_id', result.id);

              const uploadResponse = await fetch('backend/upload_image.php', {
                method: 'POST',
                credentials: 'include',
                body: formData
              });

              const uploadResult = await uploadResponse.json();
              if (!uploadResult.success) {
                console.warn('Image upload failed:', uploadResult.message);
              }
            }

            showNotification('Coordinator added successfully!', 'success');
            addModal.classList.remove('active');
            loadCoordinators();
          } else {
            showNotification('Error: ' + (result.message || 'Unknown error'), 'error');
          }
        } catch (error) {
          console.error('Add coordinator error:', error);
          showNotification('Error adding coordinator. Please try again.', 'error');
        }
      });

      // Delete coordinator function
      async function deleteCoordinator(id, name) {
        if (!confirm(`Are you sure you want to delete ${name}?`)) {
          return;
        }

        try {
          const response = await fetch(`backend/delete_coordinator.php?id=${id}`, {
            credentials: 'include'
          });

          const result = await response.json();
          
          if (result.success) {
            showNotification('Coordinator deleted successfully!', 'success');
            loadCoordinators();
          } else {
            showNotification('Error: ' + (result.message || 'Unknown error'), 'error');
          }
        } catch (error) {
          console.error('Delete error:', error);
          showNotification('Error deleting coordinator. Please try again.', 'error');
        }
      }

      // Upload image function
      async function uploadImage(coordinatorId) {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        
        input.onchange = async function(e) {
          const file = e.target.files[0];
          if (!file) return;

          const formData = new FormData();
          formData.append('image', file);
          formData.append('coordinator_id', coordinatorId);

          try {
            const response = await fetch('backend/upload_image.php', {
              method: 'POST',
              credentials: 'include',
              body: formData
            });

            const result = await response.json();
            
            if (result.success) {
              showNotification('Image uploaded successfully!', 'success');
              // Preserve edit mode state before reloading
              const wasInEditMode = isEditMode;
              await loadCoordinators();
              if (wasInEditMode) {
                // Re-enable edit mode after reload
                isEditMode = false;
                toggleEditMode();
              }
            } else {
              showNotification('Error: ' + (result.message || 'Unknown error'), 'error');
            }
          } catch (error) {
            console.error('Upload error:', error);
            showNotification('Error uploading image. Please try again.', 'error');
          }
        };

        input.click();
      }

      // Load coordinators data
      async function loadCoordinators() {
        try {
          const response = await fetch('backend/get_coordinators.php');
          const result = await response.json();
          
          if (result.success && result.coordinators) {
            const grid = document.getElementById('coordinators-grid');
            grid.innerHTML = ''; // Clear existing cards
            
            result.coordinators.forEach(coordinator => {
              const imageUrl = coordinator.hasImage 
                ? `backend/get_image.php?id=${coordinator.id}` 
                : '../images/placeholder.jpg';
              
              const card = document.createElement('div');
              card.className = 'coordinator-card';
              card.dataset.id = coordinator.id;
              card.innerHTML = `
                <span class="drag-handle">‚ãÆ‚ãÆ</span>
                <button class="delete-coordinator-btn" onclick="deleteCoordinator(${coordinator.id}, '${coordinator.name.replace(/'/g, "\\'")}')">√ó</button>
                <div class="coordinator-image">
                  <img src="${imageUrl}" alt="${coordinator.name}" onerror="this.src='../images/placeholder.jpg'">
                </div>
                <button class="upload-image-btn" onclick="uploadImage(${coordinator.id})">Upload</button>
                <div class="coordinator-info">
                  <h3 class="coordinator-name">${coordinator.name}</h3>
                  <p class="coordinator-department">${coordinator.dept}</p>
                </div>
              `;
              grid.appendChild(card);
            });
          }
        } catch (error) {
          console.error('Error loading coordinators:', error);
          document.getElementById('coordinators-grid').innerHTML = 
            '<p style="text-align:center;color:#999;">Error loading coordinators. Please refresh the page.</p>';
        }
      }

      // Make functions globally available
      window.deleteCoordinator = deleteCoordinator;
      window.uploadImage = uploadImage;

      loadSession();
      loadCoordinators();
    });
  </script>

</body>
</html>